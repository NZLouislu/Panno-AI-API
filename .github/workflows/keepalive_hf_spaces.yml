name: Keep HF Spaces Alive

on:
  schedule:
    - cron: "*/15 * * * *" # Every 15 minutes

  workflow_dispatch: # Allow manual trigger

jobs:
  ping-api:
    runs-on: ubuntu-latest
    timeout-minutes: 5

    steps:
      - name: Ping HF Spaces API
        env:
          HF_SPACES_URL: ${{ secrets.HF_SPACES_API_URL }}
        run: |
          if [ -z "$HF_SPACES_URL" ]; then
            echo "‚ùå Error: HF_SPACES_API_URL secret is not set."
            exit 1
          fi
          
          echo "üîî Pinging: $HF_SPACES_URL/health"
          
          RESPONSE=$(curl -s -o /dev/null -w "%{http_code}" "$HF_SPACES_URL/health")
          
          if [ "$RESPONSE" -eq 200 ]; then
            echo "‚úÖ API is healthy! (Status: $RESPONSE)"
          else
            echo "‚ö†Ô∏è API returned unexpected status code: $RESPONSE"
            # Try to ping root if health fails
            echo "üîî Retrying with root URL: $HF_SPACES_URL/"
            ROOT_RESPONSE=$(curl -s -o /dev/null -w "%{http_code}" "$HF_SPACES_URL/")
            if [ "$ROOT_RESPONSE" -eq 200 ]; then
              echo "‚úÖ Root API is responding! (Status: $ROOT_RESPONSE)"
            else
              echo "‚ùå All ping attempts failed. (Root Status: $ROOT_RESPONSE)"
              exit 1
            fi
          fi
